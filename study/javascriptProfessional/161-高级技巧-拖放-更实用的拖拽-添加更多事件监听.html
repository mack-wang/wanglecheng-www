<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<div id="box2" class="draggable" style="width: 100px;height: 100px;background-color: red; position: absolute;"></div>

<div id="box3"></div>
<div id="box4"></div>
<div id="box5"></div>
</body>
<script src="EventUtil.js"></script>
<script type="text/javascript">

    //以下案例做到了div跟随鼠标
    //    EventUtil.addHandler(document,"mousemove",function (event) {
    //        var box = document.getElementById("box");
    //        box.style.left=event.clientX+"px";
    //        box.style.top=event.clientY + "px";
    //    });

    //以下是通用拖放函数，只要给指定元素添加draggable类即可，使其被拖动，并注意，对象的position一定得是absolute;


    //dragdrop有点问题
    var DragDrop = function () {
        var dragging = null,
        dragdrop = EventTarget(),
        diffX = 0,
        diffY = 0;

        function handleEvent(event) {
            event = EventUtil.getEvent(event);
            var target = EventUtil.getTarget(event);

            switch (event.type) {
                case "mousedown":
                    if (target.className.indexOf("draggable") > -1) {
                        dragging = target;
                        diffX=event.clientX-target.offsetLeft;
                        diffY=event.clientY-target.offsetTop;
                        dragdrop.fire({type:"dragstart",target:dragging,X:event.clientX,y:event.clientY});
                    }
                    break;

                case "mousemove":
                    if (dragging !== null) {
                        dragging.style.left = (event.clientX-diffX) + "px";
                        dragging.style.top = (event.clientY-diffY) + "px";
                        dragdrop.fire({type:"drag",target:dragging,x:event.clientX,y:event.clientY});

                    }
                    break;
                case "mouseup":
                    dragdrop.fire({type:"dragend",target:dragging,x:event.clientX,y:event.clientY});
                    dragging = null;
                    break;
            }
        };


            dragdrop.enable=function () {
                EventUtil.addHandler(document, "mousedown", handleEvent);
                EventUtil.addHandler(document, "mousemove", handleEvent);
                EventUtil.addHandler(document, "mouseup", handleEvent);
            };

            dragdrop.disabled=function () {
                EventUtil.removeHandler(document, "mousedown", handleEvent);
                EventUtil.removeHandler(document, "mousemove", handleEvent);
                EventUtil.removeHandler(document, "mouseup", handleEvent);
            };

            return dragdrop;
    }();


    //
    var box2 =document.getElementById("box2");
    var box3 =document.getElementById("box3");
    var box4 =document.getElementById("box4");
    var box5 =document.getElementById("box5");


    DragDrop.enable(box2);

    DragDrop.addHandler("dragstart",function (event) {
        box3.innerHTML="拖拽刚开始时，被拖着的对象ID是："+event.target.id;
    });

    DragDrop.addHandler("drag",function (event) {
        box4.innerHTML="拖拽进行中，被拖着的对象的ID是："+event.target.id+"他正在什么位置："+event.x+"----"+event.y;
    });

    DragDrop.addHandler("dragend",function (event) {
        box5.innerHTML="拖拽结束后，被拖着的对象的ID是："+event.target.id+"他正在什么位置："+event.x+"----"+event.y;
    });


</script>

</html>
